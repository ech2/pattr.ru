---
layout:     blogpost
title:      "Полиритмический Секвенсор в Max/MSP"
date:       2011-10-17 01:03:09
categories: blog
author:     "OSCII"
permalink:  /polyrythmic-sequencer-with-maxmsp.html
alias:      /blog/sekvensor-dlya-poliritmov-v-maxmsp
attach:     maxmsp-polyrythmic-sequencer.zip
---

<p>Что я знаю о полиритмах? Не особо много; кажется, это когда одновременно играют два или более ритма разных размеров,
  причем проигрываются они за одно и то же время. Приведу картинку для наглядности.</p>
<img src="/img/polyrhythms/01.png" alt="Два ритма разных размеров проигрваются за одно время"/>

<p>Этот прием используется в этнической музыке жителей африканского континента, а также многими хорошими барабанщиками.
  В этой статье будет описываться способ, который я использую для генерации таких ритмов.</p>

<h2>Инструментарий</h2>

<p>Ритмы можно наглядно представить в виде последовательности единиц и нулей, где <em>1</em> – это удар, а
  <em>0</em> — тишина. Общее количество элементов определяет длину ритма. В максе представить ритм таким способом легче
  всего с помощью сообщений:</p>

<p><img src="/img/polyrhythms/02.png" alt="Ритмы представленные в виде набора нулей и единиц"/></p>

<p>В первом ритме <em>16 </em>элементов, во втором — <em>10</em>. Проигрывать их мы будем с помощью объекта
  <strong>seq~</strong>. Он работает следующим образом: мы последовательно забиваем события, для каждого из которых
  определяем условие, при котором оно будет выводиться.
  <strong>seq~</strong> принимает аудио сигнал, сравнивает его значение с внесенными данными и при совпадении выводит
  сохраненное сообщение. Например, сделаем так, чтобы объект выдавал
  <em>bang</em>, когда значение входящего сигнала будет равняться <em>0.5</em>. Для этого надо в
  <strong>seq~</strong> послать сообщение <em>(add my_rythm 0.5 bang)</em>. Теперь, когда значение входящего в <strong>seq~</strong>
  сигнала будет равняться
  <em>0.5</em>, объект выдаст <em>bang </em>через левый аутлет. Для облегчения понимания работы объекта я создал
  небольшой патч с комментариями, который по должен помочь разобраться с его работой
  <em>(seqhowto.maxpat)</em>.
</p>

<p><img src="/img/polyrhythms/03.png" alt="Надеюсь, этот патч поможет"/></p>

<p>Идем далее. На данный момент нам требуется вбить последовательность из единиц и нулей в объект
  <strong>seq~</strong>. Для этой цели некоторое время назад я создал небольшую <em>абстракцию </em>под названием
  <strong>rtoseq </strong>
  <em>(rhythm to seq~)</em>.
  <em>Абстракциями </em>в максе называют патчи, созданные для того, чтобы их можно было использовать, как объекты, у
  программистов это называется
  <em>reusable code</em>. Абстракции имеют то же расширение
  <em>.maxpat</em> и могут быть добавлены точно также, как и объекты.</p>

<p><img src="/img/polyrhythms/04.png" alt="Внутренности rtoseq"/></p>

<h2>Принцип работы</h2>

<p><strong>rtoseq </strong>очень прост. Он принимает список из единиц и нулей, проходится по каждому элементу и для
  каждой единицы формирует сообщение, создающее событие в
  <strong>seq~</strong>. Не буду подробно объяснять его работу, так как это статья о полиритмах, да и кому интересно,
  тот сможет разобрать что к чему за 15 минут.
  Итак, взглянем на следующий патч <em>(polyrhythms01.maxpat)</em>:</p>

<p><img src="/img/polyrhythms/05.png" alt="polyrhythms01.maxpat"/></p>

<p>При нажатии на сообщение, объект <strong>rtoseq </strong>«забивает» ритм в объекты <strong>seq~</strong>, сигнал из
  <strong>phasor~</strong> управляет выводом сохраненных в <strong>seq~</strong> сообщений. Сообщение <em>(play 1, seq
    rtoseq)</em> требуется для включения <strong>seq~</strong> (за подробностями идем в хелп).</p>

<p>Однако задание ритма напрямую через сообщение не очень удобно, поэтому мы сделаем небольшой интерфейс <em>(polyrhythms02.maxpat)</em>.
</p>

<p><img src="/img/polyrhythms/06.png" alt="polyrhythms02.maxpat"/></p>

<p>Объект <strong>multislider </strong>при каждом редактировании посылает через <em>левый аутлет </em>список значений всех слайдеров. Сообщение <em>(size&nbsp;$1)</em> меняет количество слайдеров. В инспекторе объекта сделаны следующие изменения:</p>

<ul>
  <li><em>Range: 0. 1. </em>– диапазон значений слайдеров;</li>
  <li><em>Slider Style: Bar </em>– внешний вид слайдеров;</li>
  <li><em>Sliders Output Values: Integer </em>– в слайдерах будут целочисленные значения;</li>
  <li><em>Thin Line Thickness: 2 </em>– создаем расстояние между слайдерами.</li>
</ul>

<p>Таким образом мы превращаем мультислайдер в своего рода редактор паттернов.</p>

<h2>Заключение</h2>

<p>Данный способ дает нам не только возможность программировать любые полиритмы, но также предоставляет богатые возможности для экспериментов, если мы будем управлять объектами
<strong>seq~</strong> не с помощью пилы, а с помощью произвольного аудио сигнала: синусоида, треугольник, белый шум, да хоть сигнал с линейного входа – вариантов много.</p>