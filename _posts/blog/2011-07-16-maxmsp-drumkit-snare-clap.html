---
layout: blogpost
title:  "Синтез ударных в Max/MSP. Часть 2: snare и clap"
date:   2011-07-16 15:44:29
categories: blog
author: "OSCII"
permalink: /drum-synthesis-in-maxmsp-snare-clap.html
alias: /blog/chast-2-snare-and-clap
---

<p>
  Прежде чем приступить к синтезу снейра, нужно понять, как работает его &laquo;живой&raquo; собрат. Снейр имеет две
  головки (вибрирующие мембраны). На нижней натянуты струны, о которые бьется мембрана после удара барабанщика. На фото
  ниже они как раз показаны.</p>
<p>
  <img alt="" src="https://cloud.githubusercontent.com/assets/1007225/4955806/d879151e-6697-11e4-8782-aa7e97ae5708.jpg"/></p>


<p>
  Получается, нам нужно эмулировать звук двух мембран и шум, исходящий от струн. Мы не будем заниматься физическим
  моделированием, вместо этого воссоздадим алгоритм снейра легендарного синтезатора <b>Roland TR-909</b>, элементы
  которого воссозданы по подобию реального барабана.v</p>
<p>
  Роль мембран выполняет треугольная волна, а роль струн &mdash; белый шум. Частота двух треугольных сигналов отличается
  примерно в два раза (там, где частота больше &mdash; верхняя мембрана, где меньше &mdash; нижняя). Каждая мембрана
  имеет огибающую громкости, причем нижняя звучит чуть дольше верхней. Шум обрабатывается цепочкой из <i>LP</i> и
  <i>HP</i> фильтров и идет через огибающую громкости. Обратите внимание, что для шума делается две огибающие: одна
  обрабатывает сигнал из <i>LPF</i>, другая из <i>HPF</i>. Это при том, что сигнал после <i>LPF</i> одновременно
  поступает и в <i>HPF</i>, и на огибающую, в общем, смотрите патч, там понятнее будет.</p>
<p>
  Теперь приступим к созданию патча. Треугольный сигнал генерируется объектом <b>tri~</b>. Для огибающей опять будем
  использовать связку из <b>line~</b> и <b>function</b>. Так как в оригинальном <b>TR-909</b> огибающие нелинейны, то,
  как и в прошлой статье, мы перемножим выход <b>line~</b> на себя. Еще в инспекторе стоит изменить параметр <i>High
  Domain Display Value (X-Asis)</i> на <i>200</i>, чтобы не приходилось мельтешить при редактировании огибающей. Он
  задает длину всей огибающей в пределах рамки объекта на <i>200 мс</i>. Результат:</p>
<p>
  <img alt="" src="https://cloud.githubusercontent.com/assets/1007225/4955803/d86ce884-6697-11e4-9399-5e9c48d0f23f.png"/></p>
<p>
  Не очень похоже на снейр, не правда ли? :) Ничего, сейчас добавим шума, и все будет круто. Фильтровать будем с помощью
  объекта <b>lores~</b>, это резонантный <i>lowpass </i>фильтр. В левый вход подается сигнал, который нужно фильтровать,
  во второй значение cutoff и в третий resonance. К сожалению, в максе нет аналогичного объекта для hipass фильтра, но
  это не беда: <i>LP</i> легко превращается в <i>HP</i>. Для этого нужно вычесть из оригинального сигнала
  отфильтрованный <i>LP</i>. Вот так это выглядит в максе:</p>
<p>
  <img alt="" src="https://cloud.githubusercontent.com/assets/1007225/4955805/d875be8c-6697-11e4-857f-5380d9ac7a9f.png"/>
</p>
<p>
  Итак, строим окончательную версию патча. Обратите внимание на путь сигнала между фильтрами. Также я увеличил значение
  <i>X-Asis в function</i> до <i>500</i>, т. к. шум затухает гораздо медленнее мембраны.</p>
<p>
  <img alt="" src="https://cloud.githubusercontent.com/assets/1007225/4955804/d87068ec-6697-11e4-9bb7-9a2804cf0b38.png"/></p>
<p>
  Вот теперь это точно снейр :) В статье описан самый базовый алгоритм, есть множество способов разнообразить звук:
  использовать более креативные огибающие на фильтры, заменить два треугольника двумя же синусоидами, промодулированными
  по питчу (как бы два кика), фм синтез и куча чего еще, все зависит не столько от фантазии, сколько от усидчивости
  ;)</p>
<h2>
  Clap</h2>
<p>
  Клэпы можно услышать в самой разнообразной музке: от джаза до минимал-техно. Их очень просто синтезировать &mdash;
  надо лишь сэмулировать &laquo;очередь&raquo; из хлопков и реверберацию окружения.</p>
<p>
  Хлопок в нашем синтезаторе &mdash; это белый шум, пропущенный через быстро затухающую огибающую громкости,
  соответственно, соответственно, &laquo;очередью&raquo; будет несколько повторяющихся огибающих. В нашем патче за все
  четыре &laquo;хлопка&raquo; отвечает один объект <b>function</b>.</p>
<p>
  Белый шум у нас фильтруется двумя параллельными bandpass фильтрами. Это два одинаковых фильтра, различающиеся только
  резонансом (такая конструкция появилась после недолгого эксперимента, просто мне кажется, что так звучит лучше). Также
  присутствует огибающая, модулирующая <i>cutoff</i> этих фильтров.</p>
<p>
  &laquo;Реверберация&raquo; представляет собой отфильтрованный с помощью <i>LPF</i> белый шум. Замечу, что в нашем
  случае модулятором cutoff и амплитуды является один объект function.</p>
<p>
  <img alt="" src="https://cloud.githubusercontent.com/assets/1007225/4955802/d8647532-6697-11e4-83b8-fc599c355193.png"/></p>
<p>
  <b>Важно</b>: внимательный читатель мог заметить, что к каждому объекту <b>function</b> присоединено сообщение вида
  <b>(domain <i>число</i>)</b>. Оно регулирует параметр <i>X-Axis</i>, то есть продолжительность огибающей в
  миллисекундах. Соответственно, первые две огибающие длятся по <i>40 мс</i> (они созданы для хлопков), а третья имеет
  длину <i>200 мс</i>, она регулирует &laquo;реверберацию&raquo;.</p>
<p>
  В следующей статье будем синтезировать различное железо (хэты, симбалы и тд).</p>

