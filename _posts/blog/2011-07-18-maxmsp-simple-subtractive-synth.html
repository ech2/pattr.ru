---
layout:     blogpost
title:      "Собираем Простой Субтрактивный Синтезатор в Max/MSP"
date:       2011-07-18 15:39:04
categories: blog
author:     "OSCII"
permalink:  /simple-subtractive-synth-in-maxmsp.html
alias:      /blog/sozdaem-prostoy-subtraktivnyy-sintezator-v-maxmsp
attach:     maxmsp-simple-subtractive-synth.zip
---

<p>
  Итак, друзья, мы с вами уже научились синтезировать драмсы, но для создания трека нам еще понадобятся синтезаторы, чем
  мы и займемся в этой статье. Схема синтезатора представлена на схеме ниже. Вообще, если делаете какой-нибудь алгоритм,
  лучше его нарисовать на бумаге, так будет легче собирать патч впоследствии.</p>

<p><img src="/img/simple-synth/scheme.png"/></p>
<h2>
  Осцилляторы</h2>
<p>
  Начнем с основ, генераторов звука. Четыре волны на выбор: пила, треугольник, квадрат и шум. Почему нет синусоиды? А
  зачем? У нас же субтрактивный синт, с помощью которого обычно получают жирные тембры. Вот так будет выглядеть
  осциллятор <em>(</em><em>oscil.maxpat)</em>:</p>

<p><img src="/img/simple-synth/oscil1.png"/></p>
<p>
  Здесь видно три четыре осциллятора: <strong>saw~</strong>, <strong>tri~</strong>, <strong>rect~</strong> и <strong>noise~</strong>,
  соответственно для пилы, треугольника, квадрата и белого шума. Сигналы из этих объектов поступают на входы <strong>selector~</strong>.
  Этот объект может принимать несколько сигналов, но выводит только один. Количество входов задается аргументом, а какой
  именно из них будет выводиться из объекта определяется числом, подающимся в первый инлет. В нашем случае объекту задан
  аргумент <em>4</em>, значит создано четыре дополнительных входа. Чтобы переключаться между ними нам нужно подавать
  целые числа <em>1&hellip;4</em> в первый инлет. У нас это делает объект radiogroup. Один нюанс: самое первое значение
  radiogroup выводит ноль, именно поэтому мы прибавляем единицу.</p>
<p>
  В этом патче уже реализован тюнинг осцилляторов: можно настраивать по полутонам и центам. Принцип такой: номер миди
  ноты поступает в намбербокс MIDI, потом к нему прибавляется значение из намбербокса <em>semitone</em>, после чего еще
  раз прибавляется поправка на <em>cents</em>. Обрати внимание, что один полутон равен ста центам, поэтому мы значение
  <em>cents</em> умножаем на <em>0.01</em>.</p>
<p>
  Также в этом патче есть намбербокс <em>Pulse </em><em>width</em>, он задает ширину импульса у квадратной волны.</p>
<p>
  На этом описание работы осциллятора закончено. Теперь выделяем все, кроме всех <em>намбербоксов</em> и объектов
  <strong>radiogroup</strong>, <strong>gain~</strong> и <strong>ezdac~</strong> и нажимаем <em>ctrl+</em><em>shift+</em><em>e</em>.
  Должно получиться следующее <em>(</em><em>oscil2.</em><em>maxpat)</em>:</p>

<p><img src="/img/simple-synth/oscil2.png"/></p>
<p>
  Эта функция называется инкапсуляцией &ndash; она переносит выделенные объекты в отдельный патчер, создавая внутри него
  инлеты и аутлеты. Очень удобно, советую пользоваться почаще.</p>

<h2>
  Ring modulation (RM) и микшер</h2>
<p>
  <em>Ring </em><em>modulation</em> &ndash; кольцевая модуляция уже была рассмотрена в одной из статей про синтез
  ударных. Это обычное перемножение двух сигналов, в нашем случае двух осцилляторов. Итак, дублируем наш осциллятор и
  добавляем объект *~ <em>(oscil3.maxpat)</em>:</p>

<p><img src="/img/simple-synth/oscil3.png"/></p>
<p>
  По схеме, <em>RM</em> сигнал будет подмешиваться в микс параллельно, поэтому мы просто сделаем для него отдельный
  регулятор громкости, а для двух осцилляторов прицепим обычный кроссфейд. Вот результат
  <em>(</em><em>oscil4.maxpat)</em>:</p>

<p><img src="/img/simple-synth/oscil4.png"/></p>
<p>
  Немного поясню некоторые детали. Объект <strong>dial</strong> по умолчанию выдает значения от <em>0&hellip;127</em>,
  поэтому мы делим его на <em>127</em> перед умножением на сигнал. Обрати внимание, что в объекте деления стоит в конце
  стоит точка &ndash; это нужно для&nbsp; того, чтобы объект вычислял вещественное значение; если точку не ставить, он
  будет работать в целочисленном режиме и не сможет выводить дробные числа. Объект [<strong>!- 1.] </strong>представляет
  собой обычное вычитание, только число, поступившее в левый инлет вычитается из аргумента, в нашем случае, из единицы.
</p>
<p>
  Думаю, не составит труда разобраться, как делается кроссфейд, поэтому двигаемся дальше. Опять выделяем только что
  созданные объекты кроме двух <strong>dial</strong> и инкапсулируем <em>(</em><em>oscil5.</em><em>maxpat)</em>:</p>

<p><img src="/img/simple-synth/oscil5.png"/></p>
<h2>
  Фильтр и огибающие</h2>
<p>
  Планируется переключение между двумя видами фильтров: <em>lopass</em> и <em>highpass</em>. Для огибающих у нас
  используется объекты <strong>adsr~</strong>, они генерируют обычную ADSR огибающую. Когда в первый инлет
  <strong>adsr~</strong> поступает ненулевое число, объект воспринимает его как <em>note-</em><em>on</em>, а само число
  использует для регулировки громкости. Например, если мы подадим в него <em>0.5</em>, максимальное значение огибающей
  будет <em>0.5</em>, это используется для контроля громкости ноты с помощью <em>velocity</em>. На картинке ниже
  представлен уже готовый патч, оставим для анализа читателям, он не сложный <em>(filter-adsr1.maxpat)</em>:</p>

<p><img src="http://pattr.ru/img/simple-synth/filter-adsr.png"/></p>
<h2>
  Напоследок</h2>
<p>
  Конечно, этот синтезатор еще очень сырой, здесь нет отдельного регулятора параметра <em>cutoff</em> фильтра, это
  сделано для того, чтобы не усложнять патч математическими вычислениями, которые бы корректировали срез фильтра в
  соответствии с параметром <em>Filter </em><em>amount</em>. В принципе, эту ручку можно заменить с помощью параметра
  <em>sustain</em> огибающей фильтра, хотя это и не лучшее решение.</p>
<p>
  Еще было в планах сделать синтезатор полифоническим, однако у меня все равно не получилось бы рассказать лучше, чем у
  <strong>Cycling&rsquo;74</strong> в их скринкасте, поэтому здесь лишь приведу видео, где объясняется работа объекта
  <strong>poly~</strong>.</p>
<p>
  <div class="flex-video widescreen">
    <iframe src="http://www.youtube.com/embed/y0mcWhrFrEY" frameborder="0" allowfullscreen></iframe>
  </div>
</p>